<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.patient.mapper.AdverseReactionMapper">

    <resultMap type="com.ruoyi.patient.domain.AdverseReaction" id="AdverseReactionResult">
        <id property="id" column="id"/>
        <result property="patientId" column="patient_id"/>
        <result property="drugId" column="drug_id"/>
        <result property="description" column="description"/>
        <result property="severity" column="severity"/>
        <result property="occurTime" column="occur_time"/>
        <result property="doctorConfirmed" column="doctor_confirmed"/>
    </resultMap>

    <!-- 获取所有不良反应记录 -->
    <select id="getAllAdverseReactions" resultMap="AdverseReactionResult">
        SELECT id, patient_id, drug_id, description, severity, occur_time, doctor_confirmed
        FROM gvp_adverse_reaction
    </select>

    <!-- 根据ID获取不良反应信息 -->
    <select id="getAdverseReactionById" parameterType="Long" resultMap="AdverseReactionResult">
        SELECT id, patient_id, drug_id, description, severity, occur_time, doctor_confirmed
        FROM gvp_adverse_reaction
        WHERE id = #{id}
    </select>

    <!-- 根据患者ID获取不良反应列表 -->
    <select id="getAdverseReactionsByPatientId" parameterType="Long" resultMap="AdverseReactionResult">
        SELECT id, patient_id, drug_id, description, severity, occur_time, doctor_confirmed
        FROM gvp_adverse_reaction
        WHERE patient_id = #{patientId}
    </select>

    <!-- 根据药品ID获取不良反应列表 -->
    <select id="getAdverseReactionsByDrugId" parameterType="Long" resultMap="AdverseReactionResult">
        SELECT id, patient_id, drug_id, description, severity, occur_time, doctor_confirmed
        FROM gvp_adverse_reaction
        WHERE drug_id = #{drugId}
    </select>

    <!-- 添加不良反应记录 -->
    <insert id="addAdverseReaction" parameterType="com.ruoyi.patient.domain.AdverseReaction" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO gvp_adverse_reaction (patient_id, drug_id, description, severity, occur_time, doctor_confirmed)
        VALUES (#{patientId}, #{drugId}, #{description}, #{severity}, #{occurTime}, #{doctorConfirmed})
    </insert>

    <!-- 更新不良反应记录 -->
    <update id="updateAdverseReaction" parameterType="com.ruoyi.patient.domain.AdverseReaction">
        UPDATE gvp_adverse_reaction
        SET patient_id = #{patientId},
            drug_id = #{drugId},
            description = #{description},
            severity = #{severity},
            occur_time = #{occurTime},
            doctor_confirmed = #{doctorConfirmed}
        WHERE id = #{id}
    </update>

    <update id="updateAdverseReactionConfirm" parameterType="com.ruoyi.patient.domain.AdverseReaction">
        UPDATE gvp_adverse_reaction
        SET doctor_confirmed = #{doctorConfirmed}
        WHERE id = #{id}
    </update>

    <!-- 删除不良反应记录 -->
    <delete id="deleteAdverseReaction" parameterType="Long">
        DELETE FROM gvp_adverse_reaction WHERE id = #{id}
    </delete>

</mapper>
